"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.textMatchesSearch = exports.getValueRegex = exports.getHighlightedText = exports.escapeRegExp = void 0;
/**
 * Create a regular expression to match certain keywords
 * @param  {String} value - The search keyword to highlight
 * @return {Object|Boolean} Regular expression or false
 */
const getValueRegex = value => {
  if (!value) {
    return false;
  }
  return new RegExp("(".concat(escapeRegExp(value), ")"), 'gi');
};

/**
 * Wrap a string with a <b> tag
 * @param  {String} str - The text to wrap
 * @return {String} The emboldened text
 */
exports.getValueRegex = getValueRegex;
const getWrappedMatch = str => "<b>".concat(str, "</b>");

/**
 * Highlight relevant keywords within a block of text
 * @param  {String} text - The text to parse
 * @param  {String} value - The search keyword to highlight
 * @return {String} The original text but with <b> tags wrapped around matches
 */
const getHighlightedText = (text, value) => {
  const valueRegex = getValueRegex(value);
  const matches = text.match(valueRegex);
  return value && matches ? text.replace(valueRegex, getWrappedMatch('$1')) : text;
};

/**
 * Escape string for use in a regular expression, and to prevent XSS attacks
 * All of these should be escaped: \ ^ $ * + ? . ( ) | { } [ ] < >
 * @param {String} str Search keyword string
 */
exports.getHighlightedText = getHighlightedText;
const escapeRegExp = str => {
  return str.replace(/[.*+?^${}<>()|[\]\\]/g, '\\$&');
};

/**
 * Check whether a piece of text matches the search value
 * @param {Object} text
 * @param {String} searchValue
 * @return {Boolean} True if node matches or no search value given
 */
exports.escapeRegExp = escapeRegExp;
const textMatchesSearch = (text, searchValue) => {
  if (searchValue) {
    return new RegExp(escapeRegExp(searchValue), 'gi').test(text);
  }
  return true;
};
exports.textMatchesSearch = textMatchesSearch;